<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rashad Long">

<title>Netflix Recommender System</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="Netflix Recommender Systems_files/libs/clipboard/clipboard.min.js"></script>
<script src="Netflix Recommender Systems_files/libs/quarto-html/quarto.js"></script>
<script src="Netflix Recommender Systems_files/libs/quarto-html/popper.min.js"></script>
<script src="Netflix Recommender Systems_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Netflix Recommender Systems_files/libs/quarto-html/anchor.min.js"></script>
<link href="Netflix Recommender Systems_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Netflix Recommender Systems_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Netflix Recommender Systems_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Netflix Recommender Systems_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Netflix Recommender Systems_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(images/netflix_banner.png);
background-size: cover;
      }
</style>
<link href="Netflix Recommender Systems_files/libs/vembedr-0.1.5/css/vembedr.css" rel="stylesheet">


</head>

<body class="fullcontent">

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Netflix Recommender System</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Rashad Long </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">4/6/24</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="netflix-a-global-leader-in-streaming-entertainment" class="level1">
<h1><strong>Netflix: A Global Leader in Streaming Entertainment</strong></h1>
<p><strong>Netflix, Inc.,</strong> an American media company founded in 1997, is the world’s preeminent subscription video on-demand (SVOD) service. Launched in 2007, it offers a vast library of original and acquired films and television shows across various genres. As of January 2024, Netflix boasts an impressive subscriber base exceeding 260 million paid memberships in over 190 countries, solidifying its position as the industry leader in streaming media.</p>
<p><strong>Personalized Recommendations Drive User Engagement:</strong></p>
<p>Central to Netflix’s success is its sophisticated recommendation system. This system, powered by advanced machine learning algorithms, analyzes a multitude of user data points, including viewing history, search queries, and user ratings. By leveraging these insights, Netflix curates a personalized selection of movies and TV shows, significantly enhancing user engagement and satisfaction. This data-driven approach ensures that subscribers discover content tailored to their individual preferences, fostering a more enjoyable and immersive entertainment experience. <span class="citation" data-cites="enwiki:1217276599">(<a href="#ref-enwiki:1217276599" role="doc-biblioref">Wikipedia contributors 2024</a>)</span></p>
<section id="scenario-design-analysis" class="level2">
<h2 class="anchored" data-anchor-id="scenario-design-analysis">Scenario Design Analysis</h2>
<section id="who-are-the-target-users" class="level3">
<h3 class="anchored" data-anchor-id="who-are-the-target-users">Who are the target users?</h3>
<ul>
<li><p><strong>Target Market:</strong> Netflix employs a broad market targeting strategy, encompassing individuals with a shared interest in streaming movies and television shows online.</p></li>
<li><p><strong>Historical Demographics:</strong> Traditionally, Netflix’s subscriber base exhibited a skew towards younger age groups, with a significant concentration among Generation Z and Millennial demographics.</p></li>
<li><p><strong>US Age Demographics:</strong> Data indicates that within the United States, approximately 75% of Netflix users belong to the 18-34 year old age bracket. <span class="citation" data-cites="Ana2023">(<a href="#ref-Ana2023" role="doc-biblioref">Gajic, n.d.</a>)</span></p></li>
</ul>
<p><img src="images/clipboard-2759088475.png" class="img-fluid"></p>
<p>Netflix has established a presence in a global market, with a subscriber base concentrated in the United States and Canada. However, the company has recently experienced significant growth in its reach across Europe, the Middle East, and Asia.</p>
<p><img src="images/clipboard-3901561552.png" class="img-fluid"></p>
</section>
</section>
<section id="what-are-the-key-goals" class="level2">
<h2 class="anchored" data-anchor-id="what-are-the-key-goals">What are the key goals?</h2>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Netflix Mission Statement
</div>
</div>
<div class="callout-body-container callout-body">
<p>“At Netflix, we want to entertain the world. Whatever your taste, and no matter where you live, we give you access to best-in-class TV series, documentaries, feature films and games. Our members control what they want to watch, when they want it, in one simple subscription. We’re streaming in more than 30 languages and 190 countries, because great stories can come from anywhere and be loved everywhere. We are the world’s biggest fans of entertainment, and we’re always looking to help you find your next favorite story.” <span class="citation" data-cites="Netflix2024">(<a href="#ref-Netflix2024" role="doc-biblioref">Netflix, n.d.</a>)</span></p>
</div>
</div>
<p><strong>Netflix’s Strategic Alignment and Performance Measurement</strong></p>
<p>Netflix’s success can be attributed to a strong alignment between its mission and vision. This translates into clear tactical methods that propel the brand forward and achieve its vision. This strategic alignment serves as the foundation for achieving positive results.</p>
<p><strong>Key Performance Indicators (KPIs) for Monitoring Goals</strong></p>
<p>Netflix leverages several key performance indicators (KPIs) to track and analyze progress towards its goals. These KPIs can be categorized as follows:</p>
<ul>
<li><p><strong>Reach:</strong> This metric measures the number of individuals within the target audience who have the potential to see Netflix’s advertisements on social media platforms.</p></li>
<li><p><strong>Engagement:</strong> This KPI assesses how users interact with the content Netflix presents to them. This could involve metrics like clicks, shares, comments, or time spent viewing content.</p></li>
<li><p><strong>Customer Advocacy:</strong> This metric goes beyond simple interaction and measures whether users are discussing Netflix content with others on their own initiative, signifying positive brand sentiment.</p></li>
</ul>
</section>
<section id="netflix-recommender-system" class="level2">
<h2 class="anchored" data-anchor-id="netflix-recommender-system">Netflix Recommender System</h2>
<div class="cell">
<div class="cell-output-display">
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/4aNfPe-pQqI" width="533" height="300" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
</div>
</div>
<section id="leveraging-machine-learning-for-personalized-recommendations" class="level4">
<h4 class="anchored" data-anchor-id="leveraging-machine-learning-for-personalized-recommendations"><strong>Leveraging Machine Learning for Personalized Recommendations</strong></h4>
<p>Netflix utilizes Apache Spark and machine learning algorithms to power its highly successful movie recommendation system. This system is responsible for over 80% of the content users choose to watch on the platform.</p>
</section>
<section id="personalization-process" class="level4">
<h4 class="anchored" data-anchor-id="personalization-process"><strong>Personalization Process</strong></h4>
<ul>
<li><p><strong>Dynamic Home Page:</strong> Upon logging in, users encounter a personalized home page featuring curated rows of movie recommendations.</p></li>
<li><p><strong>Data-Driven Selection:</strong> Netflix employs machine learning to analyze user data and preferences, including historical viewing habits and interaction patterns. This analysis informs the selection of specific categories and movie titles displayed on the home page.</p></li>
<li><p><strong>Ranking and Relevance:</strong> The recommendation system goes beyond simply presenting options. It leverages machine learning to sort and rank movie recommendations based on their predicted relevance to individual user preferences. Apache Spark clusters play a crucial role in efficiently running these machine learning pipelines.</p></li>
<li><p><strong>Predictive Modeling:</strong> The core of the recommendation system lies in its ability to predict user interest. This is achieved by gathering a comprehensive dataset encompassing user interactions, viewing histories of similar users, metadata from previously watched content, and user-specific device preferences.</p></li>
</ul>
</section>
<section id="recommendation-algorithm" class="level4">
<h4 class="anchored" data-anchor-id="recommendation-algorithm"><strong>Recommendation Algorithm</strong></h4>
<p>While the specifics of Netflix’s recommendation algorithm remain undisclosed, it is believed to be a hybrid approach that combines collaborative filtering and content-based filtering techniques. <span class="citation" data-cites="RecoAI">(<a href="#ref-RecoAI" role="doc-biblioref"><span>“Netflix Recommendation System: How It Works,”</span> n.d.</a>)</span></p>
<p>Netflix’s recommendation system is very complex and uses various technologies such as:</p>
<ul>
<li><p><strong>Reinforcement learning</strong> (RL algorithms don’t need any information in advance; they learn from data during the process)</p></li>
<li><p><strong>Neural networks</strong> (they try to imitate the way the human cortex works; neural networks are extremely important in deep learning)</p></li>
<li><p><strong>Causal modelling</strong> (it’s an analytically technique concentrated on the cause-and-effect relationships)</p></li>
<li><p><strong>Probabilistic graphical models</strong> (PGM expresses the conditional dependence structure between random variables)</p></li>
<li><p><strong>Matrix factorization</strong> (it’s a class of collaborative filtering algorithms used specifically in recommendation systems)</p></li>
<li><p><strong>Ensemble learning</strong> (a technique using multiple learning algorithms to achieve better results)</p></li>
</ul>
</section>
</section>
<section id="improvements" class="level2">
<h2 class="anchored" data-anchor-id="improvements">Improvements</h2>
<section id="enhancing-user-immersion-through-advanced-personalization" class="level4">
<h4 class="anchored" data-anchor-id="enhancing-user-immersion-through-advanced-personalization"><strong>Enhancing User Immersion Through Advanced Personalization</strong></h4>
<p>While Netflix’s current recommendation algorithms leverage machine learning for personalization, there’s potential for further improvement by incorporating a broader range of user behavior data.</p>
<p><strong>Beyond Explicit Ratings:</strong></p>
<p>The current system places significant weight on explicit user ratings. However, a more nuanced understanding of user preferences could be achieved by analyzing additional user behavior metrics. This includes:</p>
<ul>
<li><p><strong>Watch History Completion Rates:</strong> Analyzing the percentage of a movie or show a user completes can reveal their level of engagement with the content.</p></li>
<li><p><strong>Time Spent Browsing and Not Selecting:</strong> Time spent browsing specific genres or categories without selecting content can indicate user interest, even in the absence of an explicit selection.</p></li>
<li><p><strong>Re-watching Behavior:</strong> Re-watching behavior is a strong indicator of user preference and satisfaction with a particular movie or show.</p></li>
</ul>
<p><strong>Utilizing Implicit User Data:</strong></p>
<p>Netflix could potentially explore collecting additional implicit user data through user hardware, while ensuring user privacy is maintained. This could involve:</p>
<ul>
<li><p><strong>Eye-Tracking and Facial Recognition (with Opt-In):</strong> With user consent, Netflix could leverage eye-tracking and facial recognition technology on camera-enabled devices to gauge user attention and emotional response to content. This data could provide valuable insights into user engagement.</p></li>
<li><p><strong>Smart Device Integration:</strong> Integration with smart-watches and smart home devices (with user consent) could offer insights into the environment in which users watch content. This could be used to refine recommendations based on the user’s mood or activity.</p></li>
</ul>
<p><strong>Genre Sub-categorization:</strong></p>
<p>Refining genre classifications into sub-genres would allow for a more specific user experience. This would enable users to explore content that caters to their specific preferences within broader categories. For example, distinguishing between “comedy” and sub-genres like “stoner comedy,” “offbeat humor,” or “dark humor” would provide users with more tailored recommendations.</p>
</section>
<section id="social-recommendations" class="level4">
<h4 class="anchored" data-anchor-id="social-recommendations"><strong>Social Recommendations:</strong></h4>
<p>One approach could involve leveraging social media profiles (with user consent) to personalize recommendations based on the viewing habits of friends and family. This could be implemented as follows:</p>
<ul>
<li><p><strong>Real-Time Visibility:</strong> Users could opt-in to see what their friends and family are currently watching on Netflix in real-time. This could spark conversations and encourage co-viewing experiences.</p></li>
<li><p><strong>Enhanced Recommendation Algorithm:</strong> Social viewing data could be incorporated into the recommendation algorithm, suggesting content that aligns with the preferences of a user’s social circle.</p></li>
</ul>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Netflix, the world’s leading internet television network and most valuable streaming service, has garnered acclaim for its innovative recommendation system. Leveraging cutting-edge technologies and machine learning, Netflix’s algorithm delivers accurate and efficient suggestions with minimal latency. The system’s effectiveness stems from a hybrid approach, combining collaborative filtering and content-based filtering techniques to recommend content that aligns with user preferences, interests, and potential discoveries. Despite its success, there’s always room for improvement. Social Integration, Genre Sub-categorization, and User hardware utilization can vastly improve the recommendation system and ensure that Netflix remains at the forefront of delivering a personalized and engaging user exp</p>
<p>I was able to research and learn more about content-based and collaborative filtering in my journey studying Netflix. I learned what Apache Spark is and I learned more about different machine learning technologies that Netflix does. I would like to continue to dive into machine learning and recommendation systems. I will start with <a href="http://www.guidetodatamining.com/">A Programmer’s Guide to Data Mining</a>.</p>

</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Ana2023" class="csl-entry" role="listitem">
Gajic, Ana. n.d. <span>“Netflix Statistics.”</span> <a href="https://99firms.com/blog/netflix-statistics/#:~:text=The%20platform%20is%20used%20by,income%20of%20less%20than%20%2450%2C000.">https://99firms.com/blog/netflix-statistics/#:~:text=The%20platform%20is%20used%20by,income%20of%20less%20than%20%2450%2C000.</a>
</div>
<div id="ref-Netflix2024" class="csl-entry" role="listitem">
Netflix. n.d. <span>“The Story of Netflix.”</span> <a href="https://about.netflix.com/en">https://about.netflix.com/en</a>.
</div>
<div id="ref-RecoAI" class="csl-entry" role="listitem">
<span>“Netflix Recommendation System: How It Works.”</span> n.d. <a href="https://recoai.net/netflix-recommendation-system-how-it-works/">https://recoai.net/netflix-recommendation-system-how-it-works/</a>.
</div>
<div id="ref-enwiki:1217276599" class="csl-entry" role="listitem">
Wikipedia contributors. 2024. <span>“Netflix — <span>Wikipedia</span><span>,</span> the Free Encyclopedia.”</span> <a href="https://en.wikipedia.org/w/index.php?title=Netflix&amp;oldid=1217276599">https://en.wikipedia.org/w/index.php?title=Netflix&amp;oldid=1217276599</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>